# ZIP-Revelio: High-Level Architecture ğŸ—ï¸

"Like a well-organized warehouse where multiple workers efficiently process packages in parallel, ZIP-Revelio handles ZIP files with speed and precision!"

## System Overview
```
ZIP-Revelio
    â”‚
    â”œâ”€â”€ CLI Interface
    â”‚   â”œâ”€â”€ Argument Parser (clap)
    â”‚   â””â”€â”€ Progress Display (indicatif)
    â”‚
    â”œâ”€â”€ ZIP Processor
    â”‚   â”œâ”€â”€ Memory-Mapped Reader
    â”‚   â”œâ”€â”€ Entry Processor
    â”‚   â””â”€â”€ CRC32 Validator
    â”‚
    â”œâ”€â”€ Memory Manager
    â”‚   â”œâ”€â”€ Buffer Pool
    â”‚   â”‚   â”œâ”€â”€ Small Buffers (<64KB)
    â”‚   â”‚   â”œâ”€â”€ Medium Buffers (<1MB)
    â”‚   â”‚   â””â”€â”€ Large Memory Maps (>1MB)
    â”‚   â””â”€â”€ Resource Monitor
    â”‚
    â”œâ”€â”€ Parallel Engine
    â”‚   â”œâ”€â”€ Thread Pool (rayon)
    â”‚   â”œâ”€â”€ Work Distributor
    â”‚   â””â”€â”€ Progress Tracker
    â”‚
    â””â”€â”€ Report Generator
        â”œâ”€â”€ Stats Collector
        â””â”€â”€ Report Formatter
```

## Key Design Decisions ğŸ¤”

1. Memory Management Strategy
   ```
   File Size    Strategy          Buffer Type
   < 64KB       Direct           Stack Buffer
   64KB-1MB     Pool             Shared Buffer
   > 1MB        Memory Map       File Mapping
   ```

2. Parallel Processing Approach
   ```
   ZIP File â”€â”€> Memory Map
       â”‚
   Central Directory Read (Single Thread)
       â”‚
   â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
   â”‚Entry 1  â”‚ Worker 1 â”€â”€> Buffer Pool
   â”‚Entry 2  â”‚ Worker 2 â”€â”€> Buffer Pool
   â”‚Entry 3  â”‚ Worker 3 â”€â”€> Buffer Pool
   â”‚Entry 4  â”‚ Worker N â”€â”€> Buffer Pool
   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
        â”‚
   Stats Collection
   ```

3. Progress Tracking
   ```
   Entry Process â”€â”€> Atomic Counter â”€â”€> Progress Bar
        â”‚                â”‚                  â”‚
        â””â”€â”€ Parallel    Thread-Safe    Real-time
            Tasks       Updates        Feedback
   ```

## Core Components ğŸ”§

1. CLI Interface
   - Simple command: `cargo run -- input.zip output.txt`
   - Optional thread count configuration
   - Real-time progress with speed display
   - Graceful Ctrl+C handling

2. ZIP Processor
   - Memory-mapped file access
   - Parallel entry processing
   - CRC32 validation
   - Store/Deflate support

3. Memory Manager
   - Tiered buffer strategy
   - Pre-allocated buffer pools
   - Memory-mapped large files
   - Resource monitoring

4. Parallel Engine
   - Rayon thread pool
   - Work stealing scheduler
   - Adaptive thread count
   - Progress tracking

5. Report Generator
   ```
   === ZIP Analysis Report ===
   - Total size and compression
   - Processing duration
   - File type breakdown
   - Method statistics
   - File listing
   ```

## Performance Optimizations ğŸš€

1. Memory Strategy
   - Pre-allocated buffer pools
   - Memory mapping for large files
   - Buffer reuse
   - Minimal copying

2. Thread Management
   ```rust
   thread_count = min(
       num_cpus::get(),
       max(1, files.len() / 10)
   )
   ```

3. I/O Optimization
   - Memory mapping
   - Batch processing
   - Buffer pooling
   - Minimal allocation

## Error Handling Strategy ğŸ›¡ï¸

```
Error Type          Action
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚File Error   â”‚ â†’ Skip & Continue
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚Memory Error â”‚ â†’ Reduce Threads
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚Fatal Error  â”‚ â†’ Stop & Report
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Security Considerations ğŸ”’

1. Input Validation
   - ZIP format verification
   - ASCII filenames only
   - 4GB file size limit
   - Store/Deflate only

2. Resource Protection
   - Memory limits per thread
   - Adaptive thread count
   - Buffer pool limits
   - Graceful shutdown
