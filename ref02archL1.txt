# ZIP Analyzer Architecture ğŸ—ï¸

"ZIP files are read from the end - this is fundamental to the format. The Central Directory at the end contains the true file list and locations."

## 1. Core Architecture ğŸ¯
```
Input ZIP    â†’    Find CD     â†’    Process CD    â†’    Report
   ğŸ“¦        â†’    [End Scan]  â†’    [Entries]     â†’    ğŸ“Š
   â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ EOCD    â”œâ”€â”€â”€â”€â”€â–ºâ”‚ CD      â”œâ”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â–¼
                  Last 64KB     Central Directory  Results
```

## 2. Module Structure ğŸ“
```rust
src/
â”œâ”€â”€ main.rs       # CLI and orchestration
â”œâ”€â”€ reader.rs     # ZIP end scanning & CD reading
â”œâ”€â”€ processor.rs  # Central Directory processing
â””â”€â”€ types.rs      # ZIP format constants & types
```

## 3. Data Flow ğŸ”„
```
1. Read Last 64KB â†’ Find EOCD â†’ Get CD Location
   â”‚                    â”‚            â”‚
   â–¼                    â–¼            â–¼
[Fast Scan]      [0x06054b50]   [CD Offset]

2. Read CD â†’ Process Entries â†’ Update Results
   â”‚             â”‚               â”‚
   â–¼             â–¼               â–¼
[CD Data]    [File Info]    [Statistics]
```

## 4. ZIP Format Constants ğŸ“‹
```rust
// Record Signatures
EOCD_SIG: u32 = 0x06054b50  // End of Central Directory
CDFH_SIG: u32 = 0x02014b50  // Central Directory File Header
LFH_SIG: u32 = 0x04034b50   // Local File Header

// Format Constraints
MAX_COMMENT_SIZE: u16 = 0xFFFF  // 64KB max comment
MIN_EOCD_SIZE: u32 = 22       // Minimum EOCD record size
```

## 5. Processing Strategy ğŸ¯
```
1. End Scanning:
   - Start at EOF-22 (minimum EOCD size)
   - Scan backwards up to 64KB
   - Look for EOCD signature
   - Handle ZIP file comments

2. Central Directory:
   - Get CD offset from EOCD
   - Read CD in one operation
   - Process all file entries
   - Skip directory entries
```

## 6. Memory Model ğŸ§ 
```
End Scan Buffer   CD Buffer        Results
     64KB           Variable        Thread-Safe
      â”‚               â”‚               â”‚
[Last Block]    [File Records]    [Arc<RwLock>]
```

## 7. Error Handling ğŸš¨
```
End Scan Errors:
- No EOCD found
- Invalid CD offset
- Comment contains signature

CD Processing:
- Invalid signatures
- Corrupt entries
- Size mismatches
```

## 8. Implementation Notes ğŸ“

### ZIP Format Rules
```
1. EOCD must be last (before comment)
2. CD contains true file list
3. CD entries point to local headers
4. Directory entries end with '/'
```

### Performance Optimizations
```
1. Fast end scan (64KB max)
2. Single CD read operation
3. Parallel entry processing
4. Memory-mapped CD for large files
```

### Safety Checks
```
1. Validate all signatures
2. Check CD offset bounds
3. Verify entry sizes
4. Handle ZIP64 extensions
```